
from EASIEST.fixation import idt


def screen_find_element(cordinates, oran, current_file):
    try:
        file_string = "../files/" + current_file + ".txt"
        with open(file_string, "r") as file:  # reading the files for segmentation coordinates
            lines = file.readlines()

        for line in lines:
            line = line.strip()
            splited_strings = line.split(" ")
            # dynamically computing the adjusted (for each screen) segmentation elements coordinates
            x1 = float(splited_strings[0]) * oran
            y1 = float(splited_strings[2]) * oran
            x2 = (float(splited_strings[0]) + float(splited_strings[1])) * oran
            y2 = (float(splited_strings[2]) + float(splited_strings[3])) * oran
            # determining the screen element which the X, Y value inside
            if x1 <= cordinates[0] <= x2 and y1 <= cordinates[1] <= y2:
                return splited_strings[4]  # returning the element


    except IOError as error:
        print(error)


def test_fixation_count():
    pairs = [[1000, 1000, 100], [1010, 1050, 300], [2000, 2000, 500], [2010, 2050, 700], [2090, 3000, 900]]
    fixation_total = idt(pairs, 20, 100)

    assert len(fixation_total) == 3


def test_element_find():
    pairs = [[579, 112, 100], [590, 112, 300], [600, 112, 500]]
    fixation_pairs = idt(pairs, 20, 100)

    media_id_dictionary = {-1: "None",
                           0: "Apple",
                           1: "AVG",
                           2: "Babylon",
                           3: "BBC",
                           4: "GoDaddy",
                           5: "Yahoo"}

    for fixation in fixation_pairs:
        element = screen_find_element((fixation[0], fixation[1]), 1, media_id_dictionary[0])

        assert element == "F"


def compute_metrics(data_eye_track, current_file):
    try:
        file_string = "../files/" + current_file + ".txt"  # segmentation files that Yeliz YeÅŸilada provided
        with open(file_string, "r") as file:
            lines = file.readlines()  # each line in segmentation .txt ; for example "955 164 18 36 A"

        all_elements = {}  # empty dictionary
        for line in lines:
            line = line.strip()
            element = line.split(" ")[4]  # acquiring the element name which is 4th index (A,B,C,..)

            all_elements[element] = 0  # I created a dictionary key-value pair for each segmentation element for each web-page !!
            # I started all from 0 because

        features = {}  # empty dictionary again

        for eye_values in data_eye_track:  # eye-values : ["ID", "X", "Y", "First Time", "Duration","Total Fixation Count", "Element"]

            element = eye_values[6]  # ELEMENT value of IVT applied gaze-points
            fixation_counts = eye_values[5]  # TOTAL FIXATION COUNT of IVT applied gaze-points
            all_elements[element] = 1  # updating my all_elements dictionary (marked as seen)
            duration = float(eye_values[4])  # DURATION VALUE (will use it for % total) of IVT applied gaze-points
            first_time_look = float(eye_values[3])  # FIRST TIME LOOK of IVT applied gaze-points

            global prev  # global variable defined for feature generation

            if element in features:  # means, if this element is already defined in my feature dictionary, so I can add up my duration .. etc. varabiles onto it.
                features[element][0] += duration  # total duration appending
                features[element][3] += fixation_counts  # total fixation counts appending
                if prev != element:  # this is just determining the revisit count
                    features[element][2] += 1  # if previous element is not equal to current element then previous count increased
                prev = element  # updating the prev element for next comparison
            elif element is None:
                pass  # if patient looked non-valid parts of the web-site page, I just do nothing
            else:  # this else part is for creating the features dictionary for THE FIRST TIME ELEMENT LOOKED !!!
                features[element] = []
                features[element].append(duration)
                features[element].append(first_time_look)
                # revisits
                features[element].append(1)
                features[element].append(fixation_counts)
                prev = element

        for element in all_elements.keys():  # If there are elements on the website that the patient has never looked at, I have taken the necessary steps for the .csv file.
            if all_elements[element] == 0:
                pass
                # features[element] = []
                # features[element].append(0)
                # features[element].append(-1)
                # features[element].append(0)
                # features[element].append(0)

        return features  # returning the features dictionary to app.py (/save_data)


    except IOError as error:
        print(error)


def test_revisit_element():
    pairs = [[952.1624603179764, 53.13116775479648, 171.60000002384186], [958.8025864615347, 63.39863335360877, 199.5], [942.0091609356875, 75.51484070673625, 232.5], [940.6244536201089, 81.96433848291295, 271.0], [915.8279748072523, 79.7556039938079, 305.2000000476837], [910.9850311833329, 105.46560533388144, 336.7000000476837], [831.4343791504471, 130.40677109888662, 373.10000002384186], [776.1062057143458, 135.72448034695975, 402.4000000357628], [741.8916332332685, 153.88203983563275, 438.10000002384186], [730.5125617762078, 175.6903993750042, 470.9000000357628], [677.0142448153592, 214.8343978886262, 503.10000002384186], [666.5670190604083, 220.35732835025675, 533.9000000357628], [593.8154363636587, 229.55267028608887, 567.1000000238419], [522.5439265761247, 249.1126275087722, 596.7000000476837], [498.90711077818435, 253.7534697831202, 628.2000000476837], [460.96158127383944, 264.4549671186845, 662.2000000476837], [443.6045518021713, 265.8183332269286, 700.2000000476837], [443.0148000629538, 267.6576179323872, 737.4000000357628], [444.5952660858261, 268.5220712084739, 776.7000000476837], [426.27766508614945, 275.2549990146449, 811.3000000119209], [397.6143549654614, 270.89667611645973, 844.7000000476837], [395.92763085528065, 262.6318024424349, 880.6000000238419], [384.03635762860176, 260.41594988705407, 915.1000000238419], [375.14037985298376, 261.4922377248689, 949.9000000357628], [416.02228134540826, 251.0766462041564, 981.7000000476837], [423.67145829196204, 251.07804833741577, 1012.8000000119209], [440.2954034041179, 238.69558029547716, 1045.6000000238419], [415.59236464208914, 240.40070986810332, 1089.0], [415.5702321612481, 244.09419140719427, 1128.1000000238419], [437.42471696759196, 239.74242310507643, 1158.1000000238419], [461.28549210127983, 231.87661398334603, 1190.9000000357628], [518.8492571371129, 211.14849175113292, 1220.7000000476837], [516.7014418354329, 207.34879548470158, 1250.2000000476837], [510.7623614420887, 207.78937357206414, 1275.6000000238419], [510.722409088935, 207.63094825709402, 1303.9000000357628], [509.14588734787094, 210.5422108433126, 1336.7000000476837], [510.30443682753764, 218.3562306195397, 1371.7000000476837], [544.7956206752864, 210.08022608336245, 1403.4000000357628], [529.1627952875252, 212.0334924020972, 1435.7000000476837], [525.8926750120762, 219.92988409062843, 1463.800000011921], [519.6723129020694, 224.17556013634598, 1494.1000000238419], [548.2495892997409, 223.0675952739382, 1526.1000000238419], [529.1053567274912, 234.08818576796173, 1553.800000011921], [496.6918621869613, 246.55061615366037, 1581.6000000238419], [497.3983572991857, 247.496321328468, 1609.4000000357628], [463.77241285969603, 256.79610630638155, 1638.0], [435.4487447443994, 264.34373780864166, 1666.1000000238419], [449.8507755991769, 261.6616905470232, 1702.0], [440.2119112980936, 269.0700477334217, 1739.6000000238419], [427.5159822928481, 268.95292296010126, 1772.6000000238419], [475.8731477513446, 254.5212175004438, 1808.300000011921], [475.9846291618006, 248.40751230776098, 1838.9000000357628], [486.21542399781674, 255.16415957681292, 1866.4000000357628], [493.2795669552594, 258.05958139432795, 1895.1000000238419], [520.7817346079478, 240.27969580746174, 1925.0], [545.1576513721183, 232.63169615292836, 1956.300000011921], [538.4528785093158, 230.77556184157112, 1984.2000000476837], [530.4126609784939, 227.39957706498168, 2012.4000000357628], [499.2602650180636, 223.24171504027163, 2040.300000011921], [511.52678634301617, 218.43360380660147, 2067.100000023842], [535.9197053866926, 205.50812516070621, 2097.400000035763], [514.1278269338698, 210.57893702197475, 2124.0], [526.4888905945693, 211.74519883950632, 2150.900000035763], [546.3452269272932, 208.38084053657087, 2179.0], [539.6591438289443, 207.37302207896585, 2206.900000035763], [560.1048792136213, 201.05437655275716, 2234.800000011921], [558.5349025406299, 199.09208427260538, 2261.7000000476837], [584.8086058100306, 191.47719103628424, 2288.800000011921], [530.4487848747914, 202.59511791175632, 2316.100000023842], [512.3945808870219, 199.3578766358056, 2344.300000011921], [469.2023242164149, 220.83439081735781, 2372.400000035763], [443.13446224008567, 230.3739587112527, 2396.800000011921], [428.100315624984, 238.0121532382646, 2429.100000023842], [423.7663919557833, 240.24008398695534, 2456.0], [377.7990928873011, 241.9785844506684, 2483.0], [390.2578517961623, 234.68950929290006, 2511.400000035763], [341.47135734178903, 236.24500619441903, 2540.7000000476837], [320.74024689825615, 234.24296055399262, 2571.2000000476837], [297.25663505606417, 230.52685618553855, 2603.2000000476837], [273.83819668003775, 233.0052233298253, 2632.2000000476837], [248.99336600115487, 240.83051073957395, 2667.600000023842], [218.03724860399188, 243.48119907117666, 2697.7000000476837], [183.54345061479364, 245.01450750811895, 2729.7000000476837], [178.41200189499966, 244.7976680554876, 2762.400000035763], [176.2041862300125, 236.81773358275467, 2791.5], [180.87412410509637, 236.406646413379, 2817.600000023842], [183.742431952454, 224.2697111842317, 2845.7000000476837], [164.27670111212535, 219.7090948480517, 2871.900000035763], [169.4968822250047, 213.15758494361404, 2905.2000000476837], [143.2195026253812, 216.73763332498203, 2935.5], [173.34561422737522, 210.42060650758265, 2964.400000035763], [168.1963139511672, 213.9016166936018, 2994.400000035763], [202.47599357844, 209.8208782435074, 3027.5], [187.5476927225651, 211.77237250497393, 3060.800000011921], [181.92665055108762, 211.30255840261137, 3087.600000023842], [202.00546175708735, 202.68736890722093, 3116.5], [221.47905690432037, 204.14406769674835, 3144.5], [186.92063078389924, 208.2670303418959, 3171.100000023842], [213.4208177567416, 207.78646333742432, 3200.7000000476837], [147.4733682803046, 215.06983703153648, 3228.300000011921], [141.42906116817528, 216.90640637394105, 3254.7000000476837], [152.64918102951674, 217.37763354676895, 3284.2000000476837], [149.98065910202615, 220.58955226074778, 3315.2000000476837], [190.40690189826933, 211.47683655576012, 3347.7000000476837], [188.12448383949663, 203.8822564025107, 3383.600000023842], [153.48500518476612, 210.57370303152635, 3415.400000035763], [178.04697310290055, 206.23494967645712, 3449.7000000476837], [192.30242515012355, 204.41857043306717, 3480.0], [175.85219209513627, 199.84101241543175, 3512.100000023842], [137.51406541421102, 205.49364347000343, 3550.7000000476837], [170.66206534223272, 201.31913913865273, 3585.0], [174.6632114908225, 194.16406160109156, 3616.100000023842], [213.4193537013639, 191.34210699890167, 3645.7000000476837], [190.82956739447422, 194.13870989497198, 3671.2000000476837], [152.60791857335653, 199.10827394726994, 3699.2000000476837], [152.6228584714363, 195.6344852811857, 3727.0], [180.06244282467685, 186.70795780043497, 3754.300000011921], [187.29703023841148, 178.43256910132772, 3782.5], [189.9175004807671, 172.6790649408242, 3810.600000023842], [148.991705326118, 182.2602872692834, 3838.100000023842], [182.01104019982358, 180.32090639001785, 3866.400000035763], [209.26058001361434, 173.8639583310382, 3893.100000023842], [199.30337753926278, 173.78201972284432, 3921.300000011921], [176.38429914740345, 181.5580325982307, 3949.300000011921], [187.72055613678867, 173.99151661515313, 3976.900000035763], [189.35471718020722, 172.84755829185968, 4004.800000011921], [210.537410162043, 166.55242358511293, 4032.800000011921], [333.124226748453, 147.49626341703976, 4060.400000035763], [390.0301947237168, 153.0067423578291, 4088.100000023842], [407.94031349960653, 151.94264538867134, 4116.0], [563.8027885117582, 134.1231773895285, 4144.200000047684], [543.4360752917869, 129.24366230361136, 4171.700000047684], [516.3195419408155, 126.19467443661638, 4194.600000023842], [498.9760678532007, 136.21318822301575, 4219.100000023842], [453.5747104937067, 147.3595508525758, 4244.200000047684], [447.34813510645245, 157.64351512858548, 4269.200000047684], [423.4380692349972, 165.3921143296117, 4293.800000011921], [399.6833638091681, 172.11191763414695, 4318.600000023842], [386.2723794499343, 171.56405881197145, 4345.300000011921], [385.2402269550397, 174.9681576500004, 4373.400000035763], [391.5311990742082, 183.62118400722574, 4400.200000047684], [385.95064786685236, 190.95998992458826, 4435.700000047684], [393.9397179534508, 190.53415278337638, 4463.200000047684], [396.52042420946043, 187.1057346841855, 4491.800000011921], [406.1099219077647, 187.21984579029726, 4526.100000023842], [374.49273111979994, 187.8427576415943, 4555.300000011921], [386.20050644922094, 182.6540804405431, 4588.200000047684], [415.6661782595835, 192.4394172016439, 4615.400000035763], [425.9430031731465, 189.68421040859673, 4642.0], [459.692684676952, 186.32258497831523, 4671.5], [479.25413198382205, 194.04355312182392, 4703.300000011921], [436.5295737273665, 203.41366956534483, 4734.5], [459.76154007973, 204.90548023479047, 4766.600000023842], [482.38179996390863, 206.63723706326854, 4798.400000035763], [454.13978479520165, 208.33467794124064, 4829.600000023842], [472.9298215154612, 212.37431375784362, 4861.400000035763], [506.92895481620303, 201.14504598469424, 4893.900000035763], [514.3244249943324, 198.10821695917846, 4928.700000047684], [542.8471185601722, 186.04343252566665, 4960.700000047684], [503.25639096104624, 198.55727094543923, 4990.900000035763], [487.88028828797803, 203.11734880798394, 5020.200000047684], [486.37303438703225, 217.1622135269052, 5049.0], [520.543032614799, 198.36917168802165, 5081.300000011921], [542.165317900066, 199.85990507174688, 5110.700000047684], [586.8434316619149, 193.05067267256263, 5139.5], [629.1312439817857, 181.77230083809852, 5189.600000023842], [611.7146542857017, 185.13003368446203, 5229.700000047684], [593.5759818038374, 184.08994738691914, 5261.5], [571.7607726704462, 187.8471305225933, 5298.300000011921], [605.4461226896058, 183.6314497574989, 5325.5], [612.4862444853954, 188.51264504423153, 5353.400000035763], [611.545717112328, 185.2193159691287, 5381.200000047684], [606.7179899214054, 183.24735937004934, 5410.100000023842], [626.2174632064116, 179.0455480144653, 5441.900000035763], [580.7438528000984, 195.4761679301393, 5469.700000047684], [530.0422654903939, 203.85090177327658, 5497.600000023842], [503.52924432697137, 207.4298766179908, 5524.800000011921], [519.3598102911699, 197.91249128546676, 5553.100000023842], [514.4352976570889, 195.56170357959886, 5580.900000035763], [512.0869299619096, 197.41274786319659, 5608.700000047684], [568.6867091168261, 189.80070669105166, 5636.5], [530.3256051831733, 205.00056764578284, 5664.200000047684], [514.6087509489244, 214.8649793234909, 5692.200000047684], [517.0161668226574, 220.70899154510437, 5720.100000023842], [501.28448737776137, 225.09034434940472, 5747.600000023842], [496.7064620336928, 229.22547970094203, 5775.600000023842], [519.086536618613, 225.02033000974438, 5803.400000035763], [502.33695704583715, 227.06275038440248, 5831.100000023842], [525.1372144794332, 213.61008712641495, 5858.700000047684], [521.3618995391193, 217.61388614265869, 5886.400000035763], [586.4151634704607, 199.8212109196213, 5914.5], [553.012879992136, 209.75724599901906, 5942.100000023842], [613.5708074985523, 187.82791435662756, 5969.700000047684], [631.9810971701968, 177.3407809040634, 5997.5], [653.1117791892257, 171.1874077365959, 6025.200000047684], [615.7233042715877, 177.2093591759938, 6048.800000011921], [613.510158471152, 171.35957586536682, 6071.200000047684], [597.0531486667866, 205.74639345772144, 6094.400000035763], [582.5034554113785, 235.38408055234277, 6114.400000035763], [562.6101944469661, 230.76588286388505, 6137.400000035763], [546.3024160133097, 258.85284452341693, 6173.700000047684], [587.8064039336714, 279.0696147934217, 6198.400000035763], [563.7714209612934, 273.87832369800424, 6224.700000047684], [587.9179011348572, 269.1315027132401, 6254.5], [613.4116160669971, 297.2122079329756, 6282.400000035763], [680.6940119072178, 292.4272035157739, 6310.200000047684], [701.9618834073608, 281.5739509838232, 6337.800000011921], [751.6373759487485, 306.3664900567511, 6365.800000011921], [788.970108141471, 312.821140705336, 6393.400000035763], [806.8600436602424, 290.77852913045984, 6420.800000011921], [912.3718327864951, 391.6184390033981, 6451.800000011921], [925.2173431607976, 408.7091724473013, 6476.800000011921], [983.2518100058501, 471.24882164812254, 6506.600000023842], [984.5463215632533, 466.4342903786818, 6531.300000011921], [1011.7543060650335, 529.7554001208223, 6558.200000047684], [982.793342354973, 513.5614996553376, 6588.0], [993.5569981646756, 579.2715601968672, 6614.800000011921], [992.2383770209478, 625.8188721301722, 6641.700000047684], [974.2801994544941, 640.1237800755927, 6670.800000011921], [1014.2428050519802, 698.1405197520565, 6706.400000035763], [1045.6579942799362, 684.7020026309323, 6740.800000011921]]
    fixation_pairs = idt(pairs, 20, 100)

    media_id_dictionary = {-1: "None",
                           0: "Apple",
                           1: "AVG",
                           2: "Babylon",
                           3: "BBC",
                           4: "GoDaddy",
                           5: "Yahoo"}
    data_eye_track = []
    id_counter = 1

    for fixation in fixation_pairs:
        element = screen_find_element((fixation[0], fixation[1]), 1, media_id_dictionary[0])

        row = [id_counter, fixation[0], fixation[1], fixation[2], fixation[3], fixation[4], element]

        data_eye_track.append(row)  # appending the row to my array
        id_counter += 1  # incrementing the id counter
    print(data_eye_track)
    computed_metrics_dictionary = compute_metrics(data_eye_track, media_id_dictionary[0])
    assert computed_metrics_dictionary['C'].index(2) == 2


def test_first_time_looked():
    pairs = [[949.082770891413, 111.38643759233538, 0.0], [931.8849970568288, 136.97542577007718, 98.69999998807907], [878.4087799523131, 152.36096556274424, 157.5999999642372], [797.9242065597368, 193.9856636854726, 220.79999995231628], [693.364542627347, 180.78402940727932, 277.69999998807907], [626.4209011623457, 210.67152965098722, 334.5], [593.7383081396822, 216.62438216604673, 390.0999999642372], [513.8681408120573, 213.63471602175218, 469.69999998807907], [504.29319806742853, 244.7455568720818, 515.6999999880791], [479.07616442280766, 237.021220482642, 579.2999999523163], [491.0575206473827, 237.51312385745763, 617.3999999761581], [474.53017009822236, 231.97157886487898, 659.0], [484.53364918595923, 219.61021101460872, 711.0], [467.1703013304814, 209.7869251063808, 752.5], [451.5804498076759, 210.80017955695664, 793.6999999880791], [439.5360128443764, 215.4820548709682, 836.0999999642372], [440.6352206090414, 195.80003899416192, 878.6999999880791], [454.0902645263159, 175.23508688986874, 922.0999999642372], [456.25778906597134, 189.873274612841, 967.5999999642372], [487.07704930219916, 194.45023302106026, 1011.7999999523163], [517.9499514768762, 204.282816701982, 1057.0], [527.255611670422, 227.11469679270388, 1112.699999988079], [524.9824800946335, 235.69280109839175, 1161.2999999523163], [489.97485925979583, 232.30623116305523, 1209.5], [505.2280238057091, 234.3785699597484, 1256.7999999523163], [482.1807629068395, 239.39915626639947, 1302.0999999642372], [486.4588114874672, 235.43627507378068, 1346.5999999642372], [456.76766615156896, 227.73509858027182, 1390.3999999761581], [411.1483533455977, 229.02417836938136, 1434.199999988079], [381.76007359703704, 232.89353786573508, 1476.0999999642372], [355.834875556419, 249.41951828954646, 1517.199999988079], [356.4308342802667, 244.9869636168609, 1560.0999999642372], [370.06982308368697, 257.29224427364767, 1613.7999999523163], [375.9192300366834, 244.44312791405676, 1664.0], [393.25881096142007, 247.99504765018577, 1714.8999999761581], [421.1451950692633, 254.781228648213, 1758.8999999761581], [442.39540534619846, 264.0189930887096, 1802.699999988079], [464.5347375708883, 260.07530522890465, 1846.7999999523163], [449.39855378275547, 241.14836751100577, 1886.5], [466.6543903369301, 252.27251238457285, 1931.0], [474.39033448014686, 280.66620907736086, 1970.2999999523163], [477.7264587591252, 266.7431779546776, 2009.5999999642372], [515.4978208614356, 256.6896935133535, 2048.5], [528.1458259313796, 262.5492879790016, 2090.0], [530.1452828690516, 274.0307949168388, 2131.699999988079], [499.2374816929514, 291.50722524161034, 2172.899999976158], [486.04451188241956, 277.0024685677525, 2214.5], [499.06206762304373, 290.54843561450485, 2260.599999964237], [449.5786608510923, 281.68228876971085, 2308.899999976158], [423.7059315379819, 305.6530694203916, 2355.399999976158], [430.8260731045324, 293.62872036724815, 2398.0], [433.1025488830983, 289.1055820864698, 2444.5], [417.3896759881244, 300.6730064212807, 2487.599999964237], [393.57250814817803, 298.2962037784894, 2531.699999988079], [401.0018449245532, 272.90330690772595, 2577.199999988079], [396.0284575039102, 281.4291101875388, 2627.099999964237], [409.5461784918401, 276.3326059305535, 2670.699999988079], [412.58316035017344, 274.3971152105814, 2714.199999988079], [415.0119334493213, 287.0064167089761, 2776.0], [401.37429458206566, 309.1152105585035, 2825.5], [411.42500739536354, 312.3691163630815, 2876.399999976158], [387.11495882418865, 303.68498203881114, 2934.199999988079], [391.9940581796261, 285.3903452705676, 2977.899999976158], [407.4171027737116, 300.75478097169787, 3020.0], [397.0902690974235, 301.89136894093195, 3059.599999964237], [407.47878007579766, 321.0160057667923, 3103.699999988079], [419.677065247359, 324.2916512106931, 3148.599999964237], [437.652949876221, 325.0487892618457, 3191.899999976158], [444.1041646884795, 322.6318667473179, 3236.199999988079], [462.991915792687, 307.36374551141176, 3279.0], [446.6110824190522, 311.6312889143437, 3319.5], [423.30000944981634, 300.6154340937871, 3358.899999976158], [448.9276228591923, 285.95553503965755, 3411.599999964237], [448.29488265585553, 289.5935318092121, 3452.599999964237], [466.7676686504806, 270.5400349257117, 3492.599999964237], [459.6700505506424, 265.84341354803024, 3535.599999964237], [551.484943669573, 315.51269862271243, 3575.2999999523163], [689.6371714831032, 399.3564723361462, 3624.099999964237], [779.3091567944002, 483.58678195575834, 3671.2999999523163], [838.2746468408172, 523.862296912114, 3717.2999999523163], [914.4438245274607, 542.1011091267954, 3769.199999988079], [1001.307750887871, 536.6552043605428, 3814.399999976158], [1059.5813290087503, 565.9451064049387, 3859.899999976158], [1083.7713483379284, 627.924234854544, 3910.099999964237], [1061.1490222868736, 654.4890654814668, 3959.899999976158], [1064.44457499656, 694.258657872352, 4005.399999976158], [1049.6716099475382, 743.46008679039, 4054.899999976158], [1081.4069646981611, 728.2522378184606, 4106.0], [1079.4443380971902, 756.3797895744874, 4158.699999988079], [1105.8138437150114, 757.5167868224921, 4214.099999964237], [1068.8313720136675, 758.1786566786301, 4267.099999964237], [1110.1149908713323, 792.622565720054, 4325.399999976158], [1077.3645545813595, 764.5464994003245, 4383.899999976158], [1067.3355308543698, 799.2702646205931, 4442.199999988079]]

    fixation_pairs = idt(pairs, 20, 100)
    data_eye_track = []
    id_counter = 1

    media_id_dictionary = {-1: "None",
                           0: "Apple",
                           1: "AVG",
                           2: "Babylon",
                           3: "BBC",
                           4: "GoDaddy",
                           5: "Yahoo"}

    for fixation in fixation_pairs:
        element = screen_find_element((fixation[0], fixation[1]), 1, media_id_dictionary[0])
        row = [id_counter, fixation[0], fixation[1], fixation[2], fixation[3], fixation[4], element]
        data_eye_track.append(row)
        id_counter += 1

    computed_metrics_dictionary = compute_metrics(data_eye_track, media_id_dictionary[0])
    print(data_eye_track)
    # First time looked test
    assert round(computed_metrics_dictionary['C'].index(1), 1) == 2


def test_total_time_viewed():
    pairs = [[949.082770891413, 111.38643759233538, 0.0], [931.8849970568288, 136.97542577007718, 98.69999998807907], [878.4087799523131, 152.36096556274424, 157.5999999642372], [797.9242065597368, 193.9856636854726, 220.79999995231628], [693.364542627347, 180.78402940727932, 277.69999998807907], [626.4209011623457, 210.67152965098722, 334.5], [593.7383081396822, 216.62438216604673, 390.0999999642372], [513.8681408120573, 213.63471602175218, 469.69999998807907], [504.29319806742853, 244.7455568720818, 515.6999999880791], [479.07616442280766, 237.021220482642, 579.2999999523163], [491.0575206473827, 237.51312385745763, 617.3999999761581], [474.53017009822236, 231.97157886487898, 659.0], [484.53364918595923, 219.61021101460872, 711.0], [467.1703013304814, 209.7869251063808, 752.5], [451.5804498076759, 210.80017955695664, 793.6999999880791], [439.5360128443764, 215.4820548709682, 836.0999999642372], [440.6352206090414, 195.80003899416192, 878.6999999880791], [454.0902645263159, 175.23508688986874, 922.0999999642372], [456.25778906597134, 189.873274612841, 967.5999999642372], [487.07704930219916, 194.45023302106026, 1011.7999999523163], [517.9499514768762, 204.282816701982, 1057.0], [527.255611670422, 227.11469679270388, 1112.699999988079], [524.9824800946335, 235.69280109839175, 1161.2999999523163], [489.97485925979583, 232.30623116305523, 1209.5], [505.2280238057091, 234.3785699597484, 1256.7999999523163], [482.1807629068395, 239.39915626639947, 1302.0999999642372], [486.4588114874672, 235.43627507378068, 1346.5999999642372], [456.76766615156896, 227.73509858027182, 1390.3999999761581], [411.1483533455977, 229.02417836938136, 1434.199999988079], [381.76007359703704, 232.89353786573508, 1476.0999999642372], [355.834875556419, 249.41951828954646, 1517.199999988079], [356.4308342802667, 244.9869636168609, 1560.0999999642372], [370.06982308368697, 257.29224427364767, 1613.7999999523163], [375.9192300366834, 244.44312791405676, 1664.0], [393.25881096142007, 247.99504765018577, 1714.8999999761581], [421.1451950692633, 254.781228648213, 1758.8999999761581], [442.39540534619846, 264.0189930887096, 1802.699999988079], [464.5347375708883, 260.07530522890465, 1846.7999999523163], [449.39855378275547, 241.14836751100577, 1886.5], [466.6543903369301, 252.27251238457285, 1931.0], [474.39033448014686, 280.66620907736086, 1970.2999999523163], [477.7264587591252, 266.7431779546776, 2009.5999999642372], [515.4978208614356, 256.6896935133535, 2048.5], [528.1458259313796, 262.5492879790016, 2090.0], [530.1452828690516, 274.0307949168388, 2131.699999988079], [499.2374816929514, 291.50722524161034, 2172.899999976158], [486.04451188241956, 277.0024685677525, 2214.5], [499.06206762304373, 290.54843561450485, 2260.599999964237], [449.5786608510923, 281.68228876971085, 2308.899999976158], [423.7059315379819, 305.6530694203916, 2355.399999976158], [430.8260731045324, 293.62872036724815, 2398.0], [433.1025488830983, 289.1055820864698, 2444.5], [417.3896759881244, 300.6730064212807, 2487.599999964237], [393.57250814817803, 298.2962037784894, 2531.699999988079], [401.0018449245532, 272.90330690772595, 2577.199999988079], [396.0284575039102, 281.4291101875388, 2627.099999964237], [409.5461784918401, 276.3326059305535, 2670.699999988079], [412.58316035017344, 274.3971152105814, 2714.199999988079], [415.0119334493213, 287.0064167089761, 2776.0], [401.37429458206566, 309.1152105585035, 2825.5], [411.42500739536354, 312.3691163630815, 2876.399999976158], [387.11495882418865, 303.68498203881114, 2934.199999988079], [391.9940581796261, 285.3903452705676, 2977.899999976158], [407.4171027737116, 300.75478097169787, 3020.0], [397.0902690974235, 301.89136894093195, 3059.599999964237], [407.47878007579766, 321.0160057667923, 3103.699999988079], [419.677065247359, 324.2916512106931, 3148.599999964237], [437.652949876221, 325.0487892618457, 3191.899999976158], [444.1041646884795, 322.6318667473179, 3236.199999988079], [462.991915792687, 307.36374551141176, 3279.0], [446.6110824190522, 311.6312889143437, 3319.5], [423.30000944981634, 300.6154340937871, 3358.899999976158], [448.9276228591923, 285.95553503965755, 3411.599999964237], [448.29488265585553, 289.5935318092121, 3452.599999964237], [466.7676686504806, 270.5400349257117, 3492.599999964237], [459.6700505506424, 265.84341354803024, 3535.599999964237], [551.484943669573, 315.51269862271243, 3575.2999999523163], [689.6371714831032, 399.3564723361462, 3624.099999964237], [779.3091567944002, 483.58678195575834, 3671.2999999523163], [838.2746468408172, 523.862296912114, 3717.2999999523163], [914.4438245274607, 542.1011091267954, 3769.199999988079], [1001.307750887871, 536.6552043605428, 3814.399999976158], [1059.5813290087503, 565.9451064049387, 3859.899999976158], [1083.7713483379284, 627.924234854544, 3910.099999964237], [1061.1490222868736, 654.4890654814668, 3959.899999976158], [1064.44457499656, 694.258657872352, 4005.399999976158], [1049.6716099475382, 743.46008679039, 4054.899999976158], [1081.4069646981611, 728.2522378184606, 4106.0], [1079.4443380971902, 756.3797895744874, 4158.699999988079], [1105.8138437150114, 757.5167868224921, 4214.099999964237], [1068.8313720136675, 758.1786566786301, 4267.099999964237], [1110.1149908713323, 792.622565720054, 4325.399999976158], [1077.3645545813595, 764.5464994003245, 4383.899999976158], [1067.3355308543698, 799.2702646205931, 4442.199999988079]]

    fixation_pairs = idt(pairs, 20, 100)
    data_eye_track = []
    id_counter = 1

    media_id_dictionary = {-1: "None",
                           0: "Apple",
                           1: "AVG",
                           2: "Babylon",
                           3: "BBC",
                           4: "GoDaddy",
                           5: "Yahoo"}

    for fixation in fixation_pairs:
        element = screen_find_element((fixation[0], fixation[1]), 1, media_id_dictionary[0])
        row = [id_counter, fixation[0], fixation[1], fixation[2], fixation[3], fixation[4], element]
        data_eye_track.append(row)
        id_counter += 1

    computed_metrics_dictionary = compute_metrics(data_eye_track, media_id_dictionary[0])

    total_time = 0.0
    for element_key in computed_metrics_dictionary.keys():
        duration = computed_metrics_dictionary[element_key][0]
        total_time += duration

    for element_key in computed_metrics_dictionary.keys():
        duration = round(computed_metrics_dictionary[element_key][0], 3)
    print(data_eye_track)
    try:
        time_viewed = round((duration / total_time) * 100, 3)
        # Time viewed test
        assert (6 > time_viewed) and (time_viewed > 4)
    except ZeroDivisionError:
        time_viewed = 0

